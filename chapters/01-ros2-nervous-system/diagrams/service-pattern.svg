<?xml version="1.0" encoding="UTF-8"?>
<!--
  Chapter 1: The Robotic Nervous System (ROS 2)
  Diagram: Service Request-Response Pattern
  Alt-text: Sequence diagram showing a client sending a request to a service server,
  the server processing it, and returning a response to the waiting client
-->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 500" role="img" aria-labelledby="title desc">
  <title id="title">ROS 2 Service Request-Response Pattern</title>
  <desc id="desc">Sequence diagram illustrating how a service client sends a request to a service server, waits while the server processes it, and receives a response. This shows the synchronous, bidirectional nature of service communication.</desc>

  <!-- Background -->
  <rect width="700" height="500" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="350" y="35" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#1a1a2e">Service Request-Response Pattern</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#28a745"/>
    </marker>
    <marker id="arrow-green-left" markerWidth="10" markerHeight="7" refX="1" refY="3.5" orient="auto">
      <polygon points="10 0, 0 3.5, 10 7" fill="#28a745"/>
    </marker>
  </defs>

  <!-- Client Node -->
  <rect x="100" y="70" width="140" height="80" rx="10" fill="#28a745" stroke="#1e7e34" stroke-width="2"/>
  <text x="170" y="105" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Service Client</text>
  <text x="170" y="125" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#d4edda">planner_node</text>

  <!-- Server Node -->
  <rect x="460" y="70" width="140" height="80" rx="10" fill="#28a745" stroke="#1e7e34" stroke-width="2"/>
  <text x="530" y="105" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Service Server</text>
  <text x="530" y="125" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#d4edda">calculator_node</text>

  <!-- Lifelines -->
  <line x1="170" y1="150" x2="170" y2="420" stroke="#28a745" stroke-width="2" stroke-dasharray="8,4"/>
  <line x1="530" y1="150" x2="530" y2="420" stroke="#28a745" stroke-width="2" stroke-dasharray="8,4"/>

  <!-- Service name label -->
  <rect x="280" y="60" width="140" height="35" rx="5" fill="#d4edda" stroke="#28a745" stroke-width="2"/>
  <text x="350" y="82" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#155724">/add_two_ints</text>

  <!-- Step 1: Request -->
  <rect x="160" y="180" width="20" height="60" fill="#a3cfbb"/>
  <line x1="180" y1="200" x2="520" y2="200" stroke="#28a745" stroke-width="2" marker-end="url(#arrow-green)"/>
  <rect x="250" y="185" width="200" height="30" rx="5" fill="white" stroke="#28a745" stroke-width="1"/>
  <text x="350" y="205" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#155724">Request: {a: 5, b: 3}</text>

  <!-- Step 2: Processing -->
  <rect x="520" y="220" width="20" height="80" fill="#a3cfbb"/>
  <text x="560" y="265" font-family="Arial, sans-serif" font-size="10" fill="#495057" font-style="italic">Processing...</text>

  <!-- Step 3: Response -->
  <line x1="520" y1="320" x2="180" y2="320" stroke="#28a745" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-green-left)"/>
  <rect x="250" y="305" width="200" height="30" rx="5" fill="white" stroke="#28a745" stroke-width="1"/>
  <text x="350" y="325" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#155724">Response: {sum: 8}</text>

  <!-- Client waiting indicator -->
  <rect x="160" y="200" width="20" height="120" fill="#fff3cd" stroke="#ffc107" stroke-width="1"/>
  <text x="100" y="270" font-family="Arial, sans-serif" font-size="9" fill="#856404" font-style="italic">Client waits</text>

  <!-- Timeline labels -->
  <text x="50" y="200" font-family="Arial, sans-serif" font-size="11" fill="#495057">1. Send</text>
  <text x="50" y="270" font-family="Arial, sans-serif" font-size="11" fill="#495057">2. Wait</text>
  <text x="50" y="320" font-family="Arial, sans-serif" font-size="11" fill="#495057">3. Receive</text>

  <!-- Key characteristics box -->
  <rect x="50" y="400" width="600" height="85" rx="8" fill="white" stroke="#dee2e6" stroke-width="2"/>
  <text x="350" y="425" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1a1a2e">Key Characteristics</text>

  <circle cx="90" cy="455" r="5" fill="#28a745"/>
  <text x="105" y="459" font-family="Arial, sans-serif" font-size="11" fill="#495057">Synchronous: Client blocks until response</text>

  <circle cx="350" cy="455" r="5" fill="#28a745"/>
  <text x="365" y="459" font-family="Arial, sans-serif" font-size="11" fill="#495057">One-to-one: Single client, single server</text>

  <circle cx="90" cy="475" r="5" fill="#28a745"/>
  <text x="105" y="479" font-family="Arial, sans-serif" font-size="11" fill="#495057">Best for: Quick calculations, queries, state changes</text>
</svg>
