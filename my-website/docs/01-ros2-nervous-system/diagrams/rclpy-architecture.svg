<?xml version="1.0" encoding="UTF-8"?>
<!--
  Chapter 1: The Robotic Nervous System (ROS 2)
  Diagram: rclpy Library Architecture
  Alt-text: Layered architecture diagram showing how rclpy sits between Python
  application code and the underlying ROS 2 middleware stack
-->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 600" role="img" aria-labelledby="title desc">
  <title id="title">rclpy Library Architecture</title>
  <desc id="desc">Layered architecture diagram showing the rclpy Python client library. From top to bottom: Your Python Code (nodes, publishers, subscribers), rclpy layer (Node class, executors, parameters), rcl C library, rmw abstraction layer, and DDS middleware. Arrows show how calls flow down through the layers.</desc>

  <!-- Background -->
  <rect width="700" height="600" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="350" y="35" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#1a1a2e">rclpy Library Architecture</text>

  <!-- Layer 1: Your Python Code -->
  <rect x="100" y="70" width="500" height="80" rx="10" fill="#6366f1" stroke="#4f46e5" stroke-width="2"/>
  <text x="350" y="100" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Your Python Code</text>
  <text x="350" y="120" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e0e7ff">Nodes, Publishers, Subscribers, Services, Actions</text>
  <text x="350" y="138" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#c7d2fe" font-style="italic">my_robot_node.py</text>

  <!-- Arrow down -->
  <path d="M 350 150 L 350 175" stroke="#6c757d" stroke-width="2" marker-end="url(#arrow-down)"/>
  <defs>
    <marker id="arrow-down" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 Z" fill="#6c757d"/>
    </marker>
  </defs>

  <!-- Layer 2: rclpy -->
  <rect x="100" y="180" width="500" height="120" rx="10" fill="#0ea5e9" stroke="#0284c7" stroke-width="2"/>
  <text x="350" y="205" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">rclpy (Python Client Library)</text>

  <!-- rclpy components -->
  <rect x="120" y="220" width="100" height="35" rx="5" fill="#38bdf8"/>
  <text x="170" y="242" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0c4a6e">Node class</text>

  <rect x="230" y="220" width="100" height="35" rx="5" fill="#38bdf8"/>
  <text x="280" y="242" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0c4a6e">Executors</text>

  <rect x="340" y="220" width="100" height="35" rx="5" fill="#38bdf8"/>
  <text x="390" y="242" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0c4a6e">Parameters</text>

  <rect x="450" y="220" width="130" height="35" rx="5" fill="#38bdf8"/>
  <text x="515" y="242" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0c4a6e">Callback Groups</text>

  <text x="350" y="280" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#e0f2fe" font-style="italic">import rclpy; from rclpy.node import Node</text>

  <!-- Arrow down -->
  <path d="M 350 300 L 350 325" stroke="#6c757d" stroke-width="2" marker-end="url(#arrow-down)"/>

  <!-- Layer 3: rcl -->
  <rect x="100" y="330" width="500" height="70" rx="10" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
  <text x="350" y="360" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">rcl (ROS Client Library - C)</text>
  <text x="350" y="382" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fef3c7">Core implementation, language-agnostic</text>

  <!-- Arrow down -->
  <path d="M 350 400 L 350 425" stroke="#6c757d" stroke-width="2" marker-end="url(#arrow-down)"/>

  <!-- Layer 4: rmw -->
  <rect x="100" y="430" width="500" height="60" rx="10" fill="#22c55e" stroke="#16a34a" stroke-width="2"/>
  <text x="350" y="455" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">rmw (ROS Middleware Interface)</text>
  <text x="350" y="475" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#dcfce7">Abstraction layer for different DDS implementations</text>

  <!-- Arrow down -->
  <path d="M 350 490 L 350 515" stroke="#6c757d" stroke-width="2" marker-end="url(#arrow-down)"/>

  <!-- Layer 5: DDS -->
  <rect x="100" y="520" width="500" height="60" rx="10" fill="#64748b" stroke="#475569" stroke-width="2"/>
  <text x="350" y="545" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">DDS (Data Distribution Service)</text>
  <text x="350" y="565" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e2e8f0">Fast DDS, Cyclone DDS, Connext, etc.</text>

  <!-- Side annotations -->
  <rect x="620" y="180" width="70" height="120" rx="5" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="1"/>
  <text x="655" y="210" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#0369a1">You write</text>
  <text x="655" y="225" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#0369a1">code here</text>
  <text x="655" y="270" font-family="Arial, sans-serif" font-size="20" text-anchor="middle" fill="#0369a1">â†‘</text>

  <rect x="620" y="330" width="70" height="250" rx="5" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="655" y="450" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#64748b" transform="rotate(-90 655 450)">Handled by ROS 2</text>

  <!-- Legend -->
  <text x="50" y="100" font-family="Arial, sans-serif" font-size="10" fill="#495057">Layer 1</text>
  <text x="50" y="230" font-family="Arial, sans-serif" font-size="10" fill="#495057">Layer 2</text>
  <text x="50" y="360" font-family="Arial, sans-serif" font-size="10" fill="#495057">Layer 3</text>
  <text x="50" y="455" font-family="Arial, sans-serif" font-size="10" fill="#495057">Layer 4</text>
  <text x="50" y="545" font-family="Arial, sans-serif" font-size="10" fill="#495057">Layer 5</text>
</svg>
