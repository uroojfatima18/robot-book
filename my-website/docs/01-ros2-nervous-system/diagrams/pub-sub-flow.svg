<?xml version="1.0" encoding="UTF-8"?>
<!--
  Chapter 1: The Robotic Nervous System (ROS 2)
  Diagram: Publisher-Subscriber Communication Flow
  Alt-text: Data flow diagram showing a publisher node sending messages through
  a topic to multiple subscriber nodes, demonstrating one-to-many communication
-->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450" role="img" aria-labelledby="title desc">
  <title id="title">ROS 2 Publisher-Subscriber Flow</title>
  <desc id="desc">Diagram showing how a publisher node sends messages to a topic, which then delivers those messages to multiple subscriber nodes. This demonstrates the decoupled, one-to-many nature of topic-based communication in ROS 2.</desc>

  <!-- Background -->
  <rect width="800" height="450" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="400" y="35" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#1a1a2e">Publisher-Subscriber Communication</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0077b6"/>
    </marker>
    <marker id="arrow-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6c757d"/>
    </marker>
  </defs>

  <!-- Publisher Node -->
  <rect x="50" y="150" width="140" height="100" rx="10" fill="#0077b6" stroke="#005f8a" stroke-width="2"/>
  <text x="120" y="190" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Publisher</text>
  <text x="120" y="210" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#caf0f8">Node</text>
  <text x="120" y="235" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#90e0ef">sensor_node</text>

  <!-- Topic -->
  <rect x="280" y="160" width="180" height="80" rx="40" fill="#48cae4" stroke="#0077b6" stroke-width="3"/>
  <text x="370" y="195" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#023e8a">Topic</text>
  <text x="370" y="215" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#0077b6">/sensor/data</text>

  <!-- Subscriber Nodes -->
  <rect x="550" y="80" width="140" height="80" rx="10" fill="#0077b6" stroke="#005f8a" stroke-width="2"/>
  <text x="620" y="115" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Subscriber 1</text>
  <text x="620" y="135" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#90e0ef">logger_node</text>

  <rect x="550" y="180" width="140" height="80" rx="10" fill="#0077b6" stroke="#005f8a" stroke-width="2"/>
  <text x="620" y="215" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Subscriber 2</text>
  <text x="620" y="235" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#90e0ef">visualizer_node</text>

  <rect x="550" y="280" width="140" height="80" rx="10" fill="#0077b6" stroke="#005f8a" stroke-width="2"/>
  <text x="620" y="315" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Subscriber 3</text>
  <text x="620" y="335" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#90e0ef">controller_node</text>

  <!-- Arrows: Publisher to Topic -->
  <line x1="190" y1="200" x2="275" y2="200" stroke="#0077b6" stroke-width="3" marker-end="url(#arrow-blue)"/>
  <text x="232" y="190" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#495057">publish()</text>

  <!-- Arrows: Topic to Subscribers -->
  <path d="M 460 180 Q 500 120 545 120" stroke="#0077b6" stroke-width="2" fill="none" marker-end="url(#arrow-blue)"/>
  <line x1="460" y1="200" x2="545" y2="220" stroke="#0077b6" stroke-width="2" marker-end="url(#arrow-blue)"/>
  <path d="M 460 220 Q 500 280 545 320" stroke="#0077b6" stroke-width="2" fill="none" marker-end="url(#arrow-blue)"/>

  <!-- Message representation -->
  <rect x="220" y="280" width="80" height="50" rx="5" fill="#e0f2fe" stroke="#0077b6" stroke-width="1"/>
  <text x="260" y="300" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0077b6">Message</text>
  <text x="260" y="318" font-family="monospace" font-size="9" text-anchor="middle" fill="#495057">Float64</text>

  <line x1="260" y1="250" x2="260" y2="275" stroke="#6c757d" stroke-width="1" stroke-dasharray="3,2" marker-end="url(#arrow-gray)"/>

  <!-- Key characteristics box -->
  <rect x="50" y="360" width="700" height="75" rx="8" fill="white" stroke="#dee2e6" stroke-width="2"/>
  <text x="400" y="385" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1a1a2e">Key Characteristics</text>

  <circle cx="100" cy="410" r="5" fill="#0077b6"/>
  <text x="115" y="414" font-family="Arial, sans-serif" font-size="11" fill="#495057">One-to-many: Multiple subscribers receive same message</text>

  <circle cx="450" cy="410" r="5" fill="#0077b6"/>
  <text x="465" y="414" font-family="Arial, sans-serif" font-size="11" fill="#495057">Asynchronous: Publisher doesn't wait</text>
</svg>
